import{r as i,j as e}from"./index-DNOtO4WB.js";import{F as G}from"./Fretboard-BdrLPhB4.js";import{S as h,g as v,N as H}from"./musicUtils-Bffn_pRB.js";const _=()=>{const[b,C]=i.useState("identify"),[o,f]=i.useState("settings"),[s,w]=i.useState(null),[T,x]=i.useState(""),[M,p]=i.useState(0),[E,N]=i.useState(0),[$,g]=i.useState([]),[d,O]=i.useState({strings:Array(h.length).fill(!0),fretRange:{min:0,max:12},noteType:"all"}),[u,y]=i.useState(d),[R,m]=i.useState(""),F=i.useMemo(()=>h.slice().reverse(),[]),j=12,k=(t,r)=>Math.floor(Math.random()*(r-t+1))+t,I=i.useCallback(()=>{const t=d.strings.map((n,a)=>n?a:-1).filter(n=>n!==-1);if(t.length===0)return console.error("No strings selected in settings."),m("Please select at least one string."),null;let r=0;for(;r<100;){const n=t[k(0,t.length-1)],a=k(d.fretRange.min,d.fretRange.max),l=h.length-1-n,c=v(h[l],a);if(!c){r++;continue}if(d.noteType==="natural"&&c.includes("#")){r++;continue}return{string:n,fret:a}}return console.error("Could not find a valid note position within the current settings after 100 attempts."),m("Could not generate a question with the current settings. Try broadening the range or note types."),null},[d]),S=i.useCallback(()=>{m("");const t=I();if(!t){f("settings");return}const r=h.length-1-t.string,n=v(h[r],t.fret);if(!n){x("Error calculating note name. Please check configuration."),f("settings");return}let a;b==="identify"?(a={mode:"identify",position:t,correctNote:n},g([{string:t.string,fret:t.fret,color:"bg-yellow-400"}])):(a={mode:"find",targetNote:n},g([])),w(a),x(""),f("question")},[I,b]),Q=t=>{if(!s||s.mode!=="identify"||!s.position||!s.correctNote)return;N(n=>n+1),t===s.correctNote?(x("Correct!"),p(n=>n+1),g([{...s.position,color:"bg-green-500",label:s.correctNote}])):(x(`Incorrect. The note was ${s.correctNote}.`),g([{...s.position,color:"bg-red-500",label:s.correctNote}])),f("answered")},V=t=>{if(o!=="question"||!s||s.mode!=="find"||!s.targetNote)return;if(!d.strings[t.string]||t.fret<d.fretRange.min||t.fret>d.fretRange.max){x("Clicked outside the current practice area."),g(l=>[...l,{...t,colour:"bg-gray-400",label:"X"}]),setTimeout(()=>g(l=>l.filter(c=>!(c.string===t.string&&c.fret===t.fret&&c.color==="bg-gray-400"))),1e3);return}const r=h.length-1-t.string,n=v(h[r],t.fret);if(!n)return;N(l=>l+1),n===s.targetNote?(x("Correct!"),p(l=>l+1),g([{...t,color:"bg-green-500",label:n}])):(x(`Incorrect. That was ${n}. Try finding ${s.targetNote}.`),g([{...t,color:"bg-red-500",label:n}])),f("answered")},z=t=>{y(r=>{const n=[...r.strings];return n[t]=!n[t],{...r,strings:n}}),m("")},q=t=>{const{name:r,value:n}=t.target,a=parseInt(n,10);isNaN(a)||a<0||a>j||(y(l=>{const c={...l.fretRange,[r]:a};return r==="min"&&a>c.max&&(c.max=a),r==="max"&&a<c.min&&(c.min=a),{...l,fretRange:c}}),m(""))},A=t=>{y(r=>({...r,noteType:t.target.value})),m("")},D=()=>{if(u.strings.filter(Boolean).length===0){m("Please select at least one string.");return}if(u.fretRange.min>u.fretRange.max){m("Minimum fret cannot be greater than maximum fret.");return}O(u),p(0),N(0),x(""),w(null),g([]),m(""),f("idle")};i.useEffect(()=>{o==="idle"&&S()},[o,S]);const B=H;return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800",children:"Fretboard Trainer"}),e.jsxs("div",{className:"mb-4 border-b border-gray-300 pb-2",children:[e.jsx("label",{className:"block font-medium mb-1 text-sm text-gray-600",children:"Mode:"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"mode",value:"identify",checked:b==="identify",onChange:()=>C("identify"),className:"text-blue-600 focus:ring-blue-500",disabled:o!=="settings"}),e.jsx("span",{children:"Identify Note"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"mode",value:"find",checked:b==="find",onChange:()=>C("find"),className:"text-blue-600 focus:ring-blue-500",disabled:o!=="settings"}),e.jsx("span",{children:"Find Note"})]})]})]}),e.jsxs("details",{className:"bg-gray-100 border border-gray-300 rounded-lg mb-6 shadow",open:o==="settings",children:[e.jsx("summary",{className:"p-3 font-semibold cursor-pointer hover:bg-gray-200 rounded-t-lg",children:"Practice Settings"}),e.jsxs("div",{className:"p-4 border-t border-gray-300 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-2 text-gray-700",children:"Strings:"}),e.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-2",children:F.map((t,r)=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.strings[r],onChange:()=>z(r),className:"rounded text-blue-600 focus:ring-blue-500 h-4 w-4"}),e.jsx("span",{children:t})]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-2 text-gray-700",children:"Fret Range:"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"number",name:"min",value:u.fretRange.min,onChange:q,min:"0",max:j,className:"w-16 p-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500","aria-label":"Minimum Fret"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"number",name:"max",value:u.fretRange.max,onChange:q,min:"0",max:j,className:"w-16 p-1 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500","aria-label":"Maximum Fret"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-2 text-gray-700",children:"Note Types:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"noteType",value:"all",checked:u.noteType==="all",onChange:A,className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"All (Naturals & Sharps)"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"noteType",value:"natural",checked:u.noteType==="natural",onChange:A,className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Naturals Only"})]})]})]}),e.jsxs("div",{className:"pt-3 text-right",children:[R&&e.jsx("p",{className:"text-red-600 text-sm mb-2 text-left",children:R}),e.jsx("button",{onClick:D,className:"py-2 px-5 bg-green-600 text-white rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 transition duration-150 ease-in-out shadow",children:"Apply Settings & Start"})]})]})]}),o!=="settings"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6 min-h-[200px]",children:[" ",o==="idle"&&e.jsx("p",{className:"text-gray-600",children:"Loading question..."}),s&&(o==="question"||o==="answered")&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-semibold mb-3 text-gray-700",children:s.mode==="identify"?"Identify the highlighted note:":`Find the note: ${s.targetNote||"..."}`}),e.jsx(G,{highlightedNotes:$,fretCount:d.fretRange.max>12?d.fretRange.max:12,tuning:F,onFretClick:o==="question"&&(s==null?void 0:s.mode)==="find"?V:void 0})]})]}),o==="question"&&(s==null?void 0:s.mode)==="identify"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-md mb-2 text-gray-600",children:"Select the correct note:"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2",children:B.map(t=>e.jsx("button",{onClick:()=>Q(t),className:"py-2 px-3 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-150 ease-in-out shadow",children:t},t))})]}),o==="answered"&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg shadow mb-6 text-center",children:[e.jsx("p",{className:`text-xl font-bold mb-3 ${T.includes("Correct")?"text-green-600":"text-red-600"}`,children:T}),e.jsx("button",{onClick:S,className:"py-2 px-5 bg-indigo-600 text-white rounded hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition duration-150 ease-in-out shadow",children:"Next Question"})]}),e.jsx("div",{className:"text-right text-gray-600",children:e.jsxs("p",{children:["Score: ",M," / ",E]})})]})]})};export{_ as default};
