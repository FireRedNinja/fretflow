import{r as u,j as t}from"./index-DNOtO4WB.js";import{F as Ce}from"./Fretboard-BdrLPhB4.js";import{S as V,g as K,N as we}from"./musicUtils-Bffn_pRB.js";import{g as ee,T as $,a as Te,D as F,b as Re,c as Ie,d as _,C as Ve,e as te,f as Ae}from"./chordUtils-CP8oKaON.js";import"./intervalUtils-bYTG8tbd.js";const k={543:[2,3,4],432:[1,2,3],321:[0,1,2],654:[3,4,5],5432:[1,2,3,4],4321:[0,1,2,3],any:[]},_e=()=>{const[x,L]=u.useState("identify"),[d,T]=u.useState("settings"),[r,U]=u.useState(null),[G,b]=u.useState(""),[se,q]=u.useState(0),[ne,M]=u.useState(0),[ie,S]=u.useState([]),[y,Y]=u.useState([]),oe=["major","minor","dominant7","major7","minor7","minor7flat5"],re=["C","F","G","A","D","E","B"],ae=["root","inv1","inv2","drop2","drop3"],le=["any","543","432","321","4321"],[g,ce]=u.useState({enabledRootNotes:re,enabledQualities:oe,enabledVoicings:ae,enabledStringSets:le,applicableChordTypes:"all"}),[p,D]=u.useState(g),[J,m]=u.useState(""),W=u.useMemo(()=>V.slice().reverse(),[]),Q=12,O=e=>{if(e.length!==0)return e[Math.floor(Math.random()*e.length)]},de=e=>{switch(e){case"root":return"Root Position";case"inv1":return $.FIRST;case"inv2":return $.SECOND;case"drop2":return F.DROP_2;case"drop3":return F.DROP_3;case"any":return"Root Position";default:return null}},ge=(e,n,s)=>{if(s==="any"){console.warn("String set 'any' selected, using simplified note finding for display.");const c=e.notes,o=[],i=Array.from(new Set(c));return i.forEach(l=>{let h=null;for(let j=0;j<=Q;j++)for(let C=0;C<W.length;C++){const v=V.length-1-C;if(K(V[v],j)===l){h={string:C,fret:j},j=Q+1;break}}h&&o.push(h)}),o.length===i.length?o.sort((l,h)=>l.string-h.string):null}else return Ae(e,n,k[s],Q)},P=u.useCallback(()=>{if(m(""),g.enabledRootNotes.length===0||g.enabledQualities.length===0||g.enabledVoicings.length===0||g.enabledStringSets.length===0){m("Please select at least one option for each setting category."),T("settings");return}let e=0;for(;e<50;){e++;const n=O(g.enabledRootNotes),s=O(g.enabledQualities),c=s?te[s]:void 0;let o=O(g.enabledVoicings),i=O(g.enabledStringSets);if(!n||!c||!o||!i)continue;const l=ee(n,c);if(!l)continue;const h=l.notes.length===3,j=l.notes.length===4;if((o==="inv1"||o==="inv2")&&!h)if(g.enabledVoicings.includes("root"))o="root";else if(g.enabledVoicings.includes("any"))o="any";else continue;if((o==="drop2"||o==="drop3")&&!j)if(g.enabledVoicings.includes("root"))o="root";else if(g.enabledVoicings.includes("any"))o="any";else continue;const C=k[i],v=o==="drop2"||o==="drop3"?4:o==="inv1"||o==="inv2"?3:l.notes.length;if(i!=="any"&&C.length!==v){const w=g.enabledStringSets.find(A=>{var f;return A!=="any"&&((f=k[A])==null?void 0:f.length)===v});if(w)i=w;else if(g.enabledStringSets.includes("any"))i="any";else continue}const a=de(o);if(a===null)continue;const R=ge(l,a,i);if(!R||R.length===0)continue;let N=null;if(a===$.ROOT||a===$.FIRST||a===$.SECOND?N=Te(l,a):a===F.DROP_2?N=Re(l):a===F.DROP_3?N=Ie(l):a==="Root Position"&&(N=l.notes),!N){console.warn("Could not get target note order");continue}let I="";o==="inv1"?I=" (1st Inversion)":o==="inv2"?I=" (2nd Inversion)":o==="drop2"?I=" (Drop 2)":o==="drop3"&&(I=" (Drop 3)");const X=i!=="any"?` on Str ${i}`:"",B=`${h?_(n,c,a):_(n,c)}${h?"":I}${X}`,z=R.map(w=>{const A=V.length-1-w.string,f=K(V[A],w.fret);return{...w,label:f??"?",color:f===n?"bg-red-500":"bg-sky-500"}});let H=null;if(x==="identify"){const w=Ve.filter(f=>f.name!==c.name).sort(()=>.5-Math.random()).slice(0,3).map(f=>{const Z=ee(n,f);if(!Z)return"Invalid Distractor";const E=Z.notes.length===3,ve=E&&(o==="inv1"||o==="inv2")||!E&&(o==="drop2"||o==="drop3")?I:"";return`${E?_(n,f,a):_(n,f)}${E?"":ve}${X}`}),A=[B,...w].sort(()=>.5-Math.random());H={mode:"identify",rootNote:n,quality:c,voicingSetting:o,stringSetKey:i,correctChordName:B,targetNotes:z,targetNoteOrder:N,answerOptions:A},S(z)}else H={mode:"build",rootNote:n,quality:c,voicingSetting:o,stringSetKey:i,correctChordName:B,targetNotes:z,targetNoteOrder:N},S([]),Y([]),b("");U(H),b(""),T("question");return}m("Failed to generate a valid/playable chord with current settings after 50 attempts. Please adjust settings."),T("settings")},[g,x]),ue=e=>{if(d!=="question"||!r||r.mode!=="identify")return;M(s=>s+1),e===r.correctChordName?(b("Correct!"),q(s=>s+1),S(r.targetNotes.map(s=>({...s,color:"bg-green-500"})))):(b(`Incorrect. The chord was ${r.correctChordName}.`),S(r.targetNotes.map(s=>({...s,color:"bg-red-500"})))),T("answered")},he=e=>{if(d!=="question"||!r||r.mode!=="build")return;const n=V.length-1-e.string,s=K(V[n],e.fret);if(!s)return;const c=k[r.stringSetKey];if(r.stringSetKey!=="any"&&!c.includes(e.string)){b(`Please select notes only on strings: ${r.stringSetKey}`),setTimeout(()=>b(""),2e3);return}Y(o=>{const i=o.findIndex(h=>h.string===e.string),l=[...o];return i>-1?o[i].fret===e.fret?l.splice(i,1):l[i]={...e,noteName:s}:l.push({...e,noteName:s}),l})};u.useEffect(()=>{d==="question"&&x==="build"&&S(y.map(e=>({string:e.string,fret:e.fret,label:e.noteName,color:"bg-teal-400"})))},[y,d,x]);const pe=()=>{if(d!=="question"||!r||r.mode!=="build"||!r.targetNotes)return;M(i=>i+1);const e=r.targetNotes.length;if(y.length!==e){b(`Incorrect. Expected ${e} notes, but selected ${y.length}.`),T("answered"),S(r.targetNotes.map(i=>({...i,color:"bg-yellow-300 border border-yellow-600"})));return}const n=i=>`${i.string}-${i.fret}`,s=new Set(y.map(n)),c=new Set(r.targetNotes.map(n));if(s.size===c.size&&[...s].every(i=>c.has(i)))b("Correct!"),q(i=>i+1),S(y.map(i=>({...i,color:"bg-green-500"})));else{const i=new Set(y.map(a=>a.noteName)),l=new Set(r.targetNotes.map(a=>a.label??""));let h=i.size===l.size;if(h){for(const a of i)if(!l.has(a)){h=!1;break}}b(h?`Notes are correct, but the positions/voicing are wrong for ${r.correctChordName}.`:`Incorrect notes/positions for ${r.correctChordName}.`);const j=r.targetNotes.map(a=>({...a,color:"bg-yellow-300 border border-yellow-600"})),C=y.map(a=>({...a,color:"bg-red-500"})),v=[...j];C.forEach(a=>{const R=v.findIndex(N=>N.string===a.string&&N.fret===a.fret);R>-1&&!c.has(n(a))?v[R]=a:R===-1&&v.push(a)}),S(v)}T("answered")},me=e=>{D(n=>{const s=new Set(n.enabledRootNotes);return s.has(e)?s.delete(e):s.add(e),{...n,enabledRootNotes:Array.from(s).sort()}}),m("")},be=e=>{D(n=>{const s=new Set(n.enabledQualities);return s.has(e)?s.delete(e):s.add(e),{...n,enabledQualities:Array.from(s)}}),m("")},fe=e=>{D(n=>{const s=new Set(n.enabledVoicings);return s.has(e)?s.delete(e):s.add(e),{...n,enabledVoicings:Array.from(s)}}),m("")},xe=e=>{D(n=>{const s=new Set(n.enabledStringSets);return s.has(e)?s.delete(e):s.add(e),{...n,enabledStringSets:Array.from(s)}}),m("")},Ne=e=>{D(n=>({...n,applicableChordTypes:e.target.value})),m("")},Se=()=>{if(p.enabledRootNotes.length===0){m("Select root note(s).");return}if(p.enabledQualities.length===0){m("Select quality(ies).");return}if(p.enabledVoicings.length===0){m("Select voicing(s).");return}if(p.enabledStringSets.length===0){m("Select string set(s).");return}ce(p),q(0),M(0),b(""),U(null),S([]),m(""),T("idle")};u.useEffect(()=>{d==="idle"&&P()},[d,P]);const{applicableVoicings:ye,applicableStringSets:je}=u.useMemo(()=>{const e=[{key:"root",name:"Root Position"},{key:"any",name:"Any/Unspecified"},{key:"inv1",name:"1st Inversion"},{key:"inv2",name:"2nd Inversion"},{key:"drop2",name:"Drop 2"},{key:"drop3",name:"Drop 3"}],n=Object.entries(k);return p.applicableChordTypes==="triads"?{applicableVoicings:e.filter(s=>["root","inv1","inv2","any"].includes(s.key)),applicableStringSets:n.filter(([s,c])=>c.length===3||s==="any")}:p.applicableChordTypes==="sevenths"?{applicableVoicings:e.filter(s=>["root","drop2","drop3","any"].includes(s.key)),applicableStringSets:n.filter(([s,c])=>c.length===4||s==="any")}:{applicableVoicings:e,applicableStringSets:n}},[p.applicableChordTypes]);return t.jsxs("div",{className:"p-4 md:p-6",children:[t.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800",children:"Chord Trainer"}),t.jsxs("div",{className:"mb-4 border-b border-gray-300 pb-2",children:[" "," ",t.jsx("label",{className:"block font-medium mb-1 text-sm text-gray-600",children:"Mode:"})," ",t.jsxs("div",{className:"flex space-x-4",children:[" ",t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[" ",t.jsx("input",{type:"radio",name:"chord_mode",value:"identify",checked:x==="identify",onChange:()=>L("identify"),className:"text-blue-600 focus:ring-blue-500",disabled:d!=="settings"})," ",t.jsx("span",{children:"Identify Chord"})," "]})," ",t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[" ",t.jsx("input",{type:"radio",name:"chord_mode",value:"build",checked:x==="build",onChange:()=>L("build"),className:"text-blue-600 focus:ring-blue-500",disabled:d!=="settings"})," ",t.jsx("span",{children:"Build Chord"})," "]})," "]})," "]}),t.jsxs("details",{className:"bg-gray-100 border border-gray-300 rounded-lg mb-6 shadow",open:d==="settings",children:[" "," ",t.jsx("summary",{className:"p-3 font-semibold cursor-pointer hover:bg-gray-200 rounded-t-lg",children:"Practice Settings"})," ",t.jsxs("div",{className:"p-4 border-t border-gray-300 space-y-4",children:[" ",t.jsxs("fieldset",{className:"border p-3 rounded",children:[" ",t.jsx("legend",{children:"Root Notes"})," ",t.jsxs("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-x-3 gap-y-1 mt-1",children:[" ",we.map(e=>t.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[" ",t.jsx("input",{type:"checkbox",value:e,checked:p.enabledRootNotes.includes(e),onChange:()=>me(e),className:"rounded text-blue-600 h-4 w-4"})," ",t.jsx("span",{className:"text-sm",children:e})," "]},`root-${e}`))," "]})," "]})," ",t.jsxs("fieldset",{className:"border p-3 rounded",children:[" ",t.jsx("legend",{children:"Chord Qualities"})," ",t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-1 mt-1",children:[" ",Object.entries(te).map(([e,n])=>t.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[" ",t.jsx("input",{type:"checkbox",value:e,checked:p.enabledQualities.includes(e),onChange:()=>be(e),className:"rounded text-blue-600 h-4 w-4"})," ",t.jsx("span",{className:"text-sm",children:`${n.name} (${n.abbr[0]||"maj"})`})," "]},e))," "]})," "]})," ",t.jsxs("div",{className:"pt-2",children:[" ",t.jsx("label",{htmlFor:"applicable-types",children:"Show settings applicable for:"})," ",t.jsxs("select",{id:"applicable-types",value:p.applicableChordTypes,onChange:Ne,className:"p-1 border rounded text-sm",children:[" ",t.jsx("option",{value:"all",children:"All"})," ",t.jsx("option",{value:"triads",children:"Triads"})," ",t.jsx("option",{value:"sevenths",children:"Sevenths"})," "]})," "]})," ",t.jsxs("fieldset",{className:"border p-3 rounded",children:[" ",t.jsx("legend",{children:"Voicings"})," ",t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 mt-1",children:[" ",ye.map(({key:e,name:n})=>t.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[" ",t.jsx("input",{type:"checkbox",value:e,checked:p.enabledVoicings.includes(e),onChange:()=>fe(e),className:"rounded text-blue-600 h-4 w-4"})," ",t.jsx("span",{className:"text-sm",children:n})," "]},`voicing-${e}`))," "]})," "]})," ",t.jsxs("fieldset",{className:"border p-3 rounded",children:[" ",t.jsx("legend",{children:"String Sets"})," ",t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 mt-1",children:[" ",je.map(([e])=>t.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[" ",t.jsx("input",{type:"checkbox",value:e,checked:p.enabledStringSets.includes(e),onChange:()=>xe(e),className:"rounded text-blue-600 h-4 w-4"})," ",t.jsx("span",{className:"text-sm",children:e==="any"?"Any":`Str ${e}`})," "]},`set-${e}`))," "]})," "]})," ",t.jsxs("div",{className:"pt-3 text-right",children:[" ",J&&t.jsx("p",{className:"text-red-600 text-sm mb-2 text-left",children:J})," ",t.jsxs("button",{onClick:Se,className:"py-2 px-5 bg-green-600 text-white rounded hover:bg-green-700 shadow",children:[" ","Apply & Start"," "]})," "]})," "]})," "]}),d!=="settings"&&t.jsxs(t.Fragment,{children:[" ",t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6 min-h-[200px]",children:[" ",d==="idle"&&t.jsx("p",{className:"text-gray-600",children:"Loading question..."})," ",r&&(d==="question"||d==="answered")&&t.jsxs(t.Fragment,{children:[" ",t.jsxs("p",{className:"text-lg font-semibold mb-3 text-gray-700",children:[" ",x==="identify"?"Identify the displayed chord:":`Build the chord: ${r.correctChordName}`," "]})," ",t.jsx(Ce,{highlightedNotes:ie,fretCount:Q,tuning:W,onFretClick:d==="question"&&x==="build"?he:void 0})," "]})," "]})," ",d==="question"&&x==="identify"&&(r==null?void 0:r.answerOptions)&&t.jsxs("div",{className:"mb-6",children:[" ",t.jsx("p",{children:"Select the correct chord name:"})," ",t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[" ",r.answerOptions.map(e=>t.jsxs("button",{onClick:()=>ue(e),className:"w-full text-left py-2 px-4 bg-sky-500 text-white rounded hover:bg-sky-600 shadow",children:[" ",e," "]},e))," "]})," "]})," ",d==="question"&&x==="build"&&t.jsxs("div",{className:"mb-6 text-center",children:[" ",t.jsxs("button",{onClick:pe,className:"py-2 px-6 bg-green-600 text-white rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 shadow disabled:opacity-50",disabled:y.length===0,children:[" ","Check Answer"," "]})," "]})," ",d==="answered"&&t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg shadow mb-6 text-center",children:[" ",t.jsx("p",{className:`text-xl font-bold mb-3 ${G.includes("Correct")?"text-green-600":"text-red-600"}`,children:G})," ",t.jsxs("button",{onClick:P,className:"py-2 px-5 bg-indigo-600 text-white rounded hover:bg-indigo-700 shadow",children:[" ","Next Question"," "]})," "]})," ",t.jsxs("div",{className:"text-right text-gray-600",children:[" ",t.jsxs("p",{children:["Score: ",se," / ",ne]})," "]})," "]})]})};export{_e as default};
